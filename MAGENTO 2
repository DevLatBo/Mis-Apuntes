+## INSTALACION
## Dpendencias PHP
sudo apt-get update
sudo apt -y install software-properties-common
sudo add-apt-repository ppa:ondrej/php
sudo apt-get update

sudo apt-get install php7.x php7.x-bcmath php7.x-curl php7.x-fpm php7.x-mbstring
php7.x-gd php7.x-intl  php7.x-mysql php7.x-soap php7.x-xml php7.x-zip php7.x-common php7.x-imagick -y;

sudo apt-get install libapache2-mod-php7.x php7.x-cli php7.x-recode php7.x-tidy php7.x-xmlrpc

# MYSQL
sudo apt install mysql-server -y;
or
sudo apt install mysql-server-8.0;

sudo mysql
CREATE USER ACCESS:
mysql> CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';
mysql> GRANT ALL PRIVILEGES ON * . * TO 'user'@'localhost';
mysql> FLUSH PRIVILEGES;

# APACHE
sudo apt install apache2 -y;
sudo apt install libapache2-mod-fcgid -y;
sudo a2enmod rewrite proxy_fcgi;
sudo a2enconf php7.x-fpm;
sudo service apache2 restart;

# Cambiar username en envvars y php-fpm
# en /etc/apache2/envvars:
 user = my_user
 group = my_group
# lo mismo en /etc/php/7.x/fpm/pool.d/www.conf
 listen.user = my_user
 listen.group = my_group

# Para cambiar de version de php (Ejemplo: 8.1 a 8.2):
sudo update-alternatives  --config php
sudo a2disconf php8.1-fpm
sudo service apache2 restart
sudo a2enconf php8.2-fpm
sudo service apache2 restart
sudo a2dismod php8.1
sudo service apache2 restart
sudo a2enmod php8.2
 
* En caso de error del xdebug cambiar en vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/_bootstrap.php

if (!(bool)$debugMode && extension_loaded('xdebug')) {
    if (function_exists('xdebug_disable')) {
        xdebug_disable();
    }
}

* Para version 2.3.7 o superiores usar este comando al momento de instalar:
bin/magento setup:install --admin-firstname=Oscar --admin-lastname=Gamboa --admin-email=oscar@mail.com --admin-user=05K4R1N --admin-password=05K4R1N123 
--base-url=<url> --db-host=localhost --db-name=<database> --db-user=<user> --db-password=<pass> --currency=USD --timezone=America/Chicago --language=en_US --use-rewrites=1;

## XML VALIDACION
bin/magento dev:urn-catalog:generate .idea/misc.xml

## Compilar
bin/magento setup:di:compile

## HABILITAR NUEVO MODULO CREADO
bin/magento module:enable <nombre_modulo>

## INSTALAR MODULOS
bin/magento setup:install

## LISTAR TODOS LOS MODULOS QUE SE TIENEN EN MAGENTO
bin/magento module:status

## REGISTRAR NUEVOS MODULOS A LA BD DE MAGENTO
bin/magento setup:upgrade

## LIMPIAR CACHE
bin/magento cache:flush

## DEPLOYAR CON TEMA DE LUMA
bin/magento s:s:d -ft Magento/luma

## SOLO DEBE SER USADA EN ALGUNAS OCASIONES BAJO INTEGRACION, SU USO MUY SEGUIDO NO ES MUY RECOMENDABLE
bin/magento setup:upgrade --keep-generated

## EJEMPLO DE CREAR CREDENCIAL ADMIN:
bin/magento admin:user:create --admin-user="admin" 
--admin-password="123123q" 
--admin-email="admin@example.com" 
--admin-firstname="Admin" 
--admin-lastname="Admin"

## EN CASO DE QUE PERSISTAN LOS PROBLEMAS CON LOS PERMISOS
chmod 777 -R generated/* var/* pub/*

## Borrar contenido al hacer cambios en el front. Hacerlo antes de deployar
rm -rf var/  pub/static/frontend/ generated/

## Borrar contenido al hacer cambios en el admin. Hacerlo antes de deployar
rm -rf var/  pub/static/adminhtml/ generated/

## DEPLOYAR
bin/magento s:s:d -f

## DEPLOYAR EL TEMA CON UN PAQUETE DE IDIOMA ESPECIFICO
bin/magento s:s:d -ft <vendor>/<modulo> es_MX (para espaniol mexico)

## Desactivar el cache (recomendable para modo developer)
bin/magento cache:dis

## Modo en Mantenimiento
bin/magento maintenance:enable
bin/magento maintenance:disable

## Reindexacion
bin/magento indexer:reindex

## FIJAR TEMA DE LUMA
bin/magento sampledata:deploy
bin/magento setup:upgrade
bin/magento s:s:d -ft Magento/luma

## Admin URL
bin/magento info:adminuri

## Change frontnane admin url
bin/magento setup:config:set --backend-frontname="admin"

## Magento MODE
bin/magento deploy:mode:set developer/production
bin/magento deploy:mode:show

# Patch
bin/magento setup:db-declaration:generate-patch –type=schema Vendor_Modulo NombreArchivo
bin/magento setup:db-declaration:generate-patch –type=data Vendor_Modulo NombreArchivo

# DB Schema Whitelist JSON (Asegurarse de tener antes armado el XML db_schema.xml):
bin/magento setup:db-declaration:generate-whitelist --module-name=<Modulo>

# En caso de accidente al eliminar los Role Resources del Administrator:
En SQL:
1* Vaciar todo en las sigueintes tablas: admin_user, authorization_role, authorization_rule
2* Ejecutar las queries SQL:
INSERT INTO authorization_role (role_id, parent_id, tree_level, sort_order, role_type, user_id, user_type, role_name) VALUES (1, 0, 1, 1, 'G', 0, '2', 'Administrators'), (2, 1, 2, 0, 'U', 1, '2', 'admin');    
INSERT INTO authorization_rule (rule_id, role_id, resource_id, privileges, permission) VALUES (1, 1, 'Magento_Backend::all', NULL, 'allow');

3* Limpiar Cache:
bin/magento cache:flush
php bin/magento cache:clean

4* Crear un nuevo usuario admin con admin:user:create
